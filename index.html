<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riemann-Thomann Pers√∂nlichkeitstest</title>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .restart-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 25px;
            height: 25px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .restart-icon:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .settings-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 25px;
            height: 25px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .settings-icon:hover {
            opacity: 1;
            transform: rotate(90deg);
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-info {
            margin-top: 8px;
            font-size: 0.8em;
            opacity: 0.9;
        }

        .questions-container {
            padding: 30px 20px;
            max-height: 60vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .question {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border-left: 4px solid #2c3e50;
        }

        .question-number {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .question-text {
            font-size: 1em;
            margin-bottom: 15px;
            line-height: 1.4;
            color: #333;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .option {
            position: relative;
        }

        .option input[type="radio"] {
            display: none;
        }

        .option label {
            display: block;
            padding: 10px 8px;
            text-align: center;
            background: #e8f0fe;
            border: 2px solid #e8f0fe;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
            font-weight: 500;
            line-height: 1.2;
        }

        .option input[type="radio"]:checked + label {
            background: #3498db;
            color: white;
            border-color: #3498db;
            transform: scale(1.05);
        }

        .navigation {
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            background: #f8f9ff;
        }

        .nav-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-complete {
            background: #27ae60;
            color: white;
        }

        .btn-complete:hover:not(:disabled) {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-force-complete {
            background: #e67e22;
            color: white;
            display: none;
        }

        .btn-force-complete:hover:not(:disabled) {
            background: #d35400;
            transform: translateY(-2px);
        }

        .results {
            display: none;
            padding: 30px 20px;
            text-align: center;
        }

        .results.active {
            display: block;
        }

        .results h2 {
            color: #4facfe;
            margin-bottom: 30px;
            font-size: 1.5em;
        }

        .score-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin: 30px 0;
        }

        .score-item {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 6px;
            border-radius: 8px;
            text-align: center;
        }

        .score-label {
            font-size: 0.75em;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .score-value {
            font-size: 1.1em;
            font-weight: bold;
        }

        .visualization-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .visualization-title {
            text-align: center;
            color: #3498db;
            margin-bottom: 20px;
            font-size: 1em;
            font-weight: bold;
        }

        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .riemann-chart {
            width: 100%;
            max-width: 700px;
            height: 500px;
        }

        .axis-line {
            stroke: #94a3b8; /* slate-400 */
            stroke-width: 2; /* wieder d√ºnner */
        }
 
        .grid-line {
            stroke: #e2e8f0; /* slate-200 */
            stroke-width: 1; /* wieder d√ºnner */
        }

        .axis-label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            font-weight: bold;
            fill: #2563eb; /* primary blue */
            text-anchor: middle;
        }

        .score-point {
            fill: #f97316; /* vivid orange */
            stroke: #fff;
            stroke-width: 1.2;
        }

        .profile-polygon {
            fill: rgba(249, 115, 22, 0.28); /* vivid orange fill */
            stroke: #f97316; /* vivid orange */
            stroke-width: 4;
            stroke-linejoin: round;
        }

        .scale-text {
            font-family: 'Segoe UI', sans-serif;
            font-size: 10px;
            fill: #475569; /* slate-600 */
            text-anchor: middle;
        }

        .dominant-type {
            background: #4facfe;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .dominant-type h4 {
            margin: 20px 0 10px 0;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
        }

        .dominant-type h4:first-child {
            margin-top: 0;
        }

        .dominant-type p {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .dominant-type strong {
            color: #ffeb3b;
        }

        .personality-type {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
        }

        .personality-type-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .personality-type-header:hover {
            background: rgba(255,255,255,0.1);
        }

        .personality-type-header h3 {
            margin: 0;
            font-size: 1.2em;
        }

        .personality-type-score {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .personality-type-content {
            padding: 0 25px 25px;
            display: none;
        }

        .personality-type-content.active {
            display: block;
        }

        .personality-type-content h4 {
            margin: 20px 0 10px 0;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
        }

        .personality-type-content h4:first-child {
            margin-top: 0;
        }

        .personality-type-content p {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .personality-type-content strong {
            color: #ffeb3b;
        }

        .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .personality-type-header.active .toggle-icon {
            transform: rotate(180deg);
        }

        .question-details {
            background: #f8f9ff;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
        }

        .details-toggle {
            width: 100%;
            background: #e8f0fe;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            color: #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .details-toggle:hover {
            background: #d0e7ff;
        }

        .details-content {
            display: none;
            padding: 0 20px 20px;
        }

        .details-content.active {
            display: block;
        }

        .category-section {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .category-title {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.1em;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f0fe;
        }

        .answer-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .answer-item:last-child {
            border-bottom: none;
        }

        .answer-question {
            flex: 1;
            font-size: 0.9em;
            line-height: 1.3;
            margin-right: 15px;
        }

        .answer-value {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            white-space: nowrap;
        }

        .restart-btn {
            background: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }



        .download-btn {
            background: #e67e22;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            margin-left: 15px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #d35400;
            transform: translateY(-2px);
        }





        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            color: #3498db;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .settings-group {
            margin-bottom: 25px;
        }

        .settings-group h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
        }

        .point-input {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .point-input label {
            flex: 1;
            font-size: 0.9em;
        }

        .point-input input {
            width: 70px;
            padding: 5px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }



        .max-points {
            text-align: center;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            color: #28a745;
        }

        .settings-actions {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .settings-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn {
            background: #dc3545;
            color: white;
        }

        .save-btn {
            background: #28a745;
            color: white;
            margin-left: 10px;
        }

        .save-btn:hover {
            background: #218838;
        }



        .carmen-note {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #666;
            font-style: italic;
            font-size: 0.9em;
            border-top: 1px solid #eee;
        }

        .custom-weights-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.85em;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 480px) {
            .options {
                grid-template-columns: 1fr;
            }
            
            .score-grid {
                grid-template-columns: 1fr;
            }

            .presets {
                flex-direction: column;
            }

            .preset-btn {
                text-align: center;
            }

            .answer-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .answer-value {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <svg class="restart-icon" onclick="restartTest()" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,5V1L7,6L12,11V7A6,6 0 0,1 18,13A6,6 0 0,1 12,19A6,6 0 0,1 6,13H4A8,8 0 0,0 12,21A8,8 0 0,0 20,13A8,8 0 0,0 12,5Z" />
            </svg>
            <svg class="settings-icon" onclick="openSettings()" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
            </svg>
            <h1>Riemann-Thomann Pers√∂nlichkeitstest</h1>
            <p>Entdecke deine Pers√∂nlichkeitsstruktur</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-info" id="progressInfo">Frage 0 von 48</div>
        </div>

        <!-- Questions Container -->
        <div class="questions-container" id="questionsContainer">
            <!-- Questions will be loaded here -->
        </div>

        <!-- Results -->
        <div class="results" id="results">
            <div id="customWeightsNotice" class="custom-weights-notice" style="display: none;">
                ‚öôÔ∏è Benutzerdefinierte Gewichtung verwendet
            </div>
            <div class="visualization-container">
                <div class="visualization-title">Dein Pers√∂nlichkeitsprofil</div>
                <div class="chart-container">
                    <svg class="riemann-chart" id="riemannChart" viewBox="0 0 500 500">
                        <!-- Grid lines -->
                        <g id="gridLines"></g>
                        
                        <!-- Main axes -->
                        <line x1="250" y1="50" x2="250" y2="450" class="axis-line"/>
                        <line x1="50" y1="250" x2="450" y2="250" class="axis-line"/>
                        
                        <!-- Axis labels -->
                        <text x="250" y="30" class="axis-label">Dauer</text>
                        <text x="250" y="470" class="axis-label">Wechsel</text>
                        <text x="450" y="245" class="axis-label">Distanz</text>
                        <text x="50" y="245" class="axis-label">N√§he</text>
                        
                        <!-- Profile polygon -->
                        <polygon id="profilePolygon" class="profile-polygon" points=""/>
                        
                        <!-- Score points -->
                        <circle id="distanzPoint" class="score-point" r="3"/>
                        <circle id="naehePoint" class="score-point" r="3"/>
                        <circle id="dauerPoint" class="score-point" r="3"/>
                        <circle id="wechselPoint" class="score-point" r="3"/>
                        
                        <!-- Scale markers -->
                        <g id="scaleMarkers"></g>
                    </svg>
                </div>
            </div>
            
            <div class="score-grid">
                <div class="score-item">
                    <div class="score-label">Distanz</div>
                    <div class="score-value" id="scoreDistanz">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">N√§he</div>
                    <div class="score-value" id="scoreNaehe">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Dauer</div>
                    <div class="score-value" id="scoreDauer">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Wechsel</div>
                    <div class="score-value" id="scoreWechsel">0</div>
                </div>
            </div>
            
            <div class="personality-types" id="personalityTypes">
                <!-- Personality types will be populated here -->
            </div>

            <div class="question-details">
                <button class="details-toggle" onclick="toggleDetails()">
                    üìã Deine Antworten im Detail anzeigen
                    <span id="toggleIcon">‚ñº</span>
                </button>
                <div class="details-content" id="detailsContent">
                    <!-- Content will be populated here -->
                </div>
            </div>

            <button class="restart-btn" onclick="restartTest()">Test wiederholen</button>
            <button class="download-btn" onclick="downloadPDF()">üíæ PDF herunterladen</button>
        </div>

        <div class="navigation" id="navigation">
            <button class="nav-btn btn-complete" id="completeBtn" onclick="completeTest()">Test abschlie√üen</button>
            <button class="nav-btn btn-force-complete" id="forceCompleteBtn" onclick="forceCompleteTest()">Test trotzdem abschlie√üen</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSettings()">√ó</button>
            <div class="modal-header">
                <h3>‚öôÔ∏è Bewertungseinstellungen</h3>
            </div>
            
            <div class="settings-group">
                <h4>Punktverteilung anpassen:</h4>
                <div class="point-input">
                    <label>stimmt genau:</label>
                    <input type="number" id="points3" min="0" step="0.01" value="1.00">
                </div>
                <div class="point-input">
                    <label>stimmt eher:</label>
                    <input type="number" id="points2" min="0" step="0.01" value="0.67">
                </div>
                <div class="point-input">
                    <label>stimmt wenig:</label>
                    <input type="number" id="points1" min="0" step="0.01" value="0.33">
                </div>
                <div class="point-input">
                    <label>stimmt nicht:</label>
                    <input type="number" id="points0" min="0" step="0.01" value="0.00">
                </div>
            </div>

            <div class="max-points" id="maxPointsDisplay">
                Maximale Gesamtpunktzahl: 48.0
            </div>

            <div class="settings-actions">
                <button class="settings-btn reset-btn" onclick="resetToDefaults()">Zur√ºcksetzen</button>
                <button class="settings-btn save-btn" onclick="saveSettingsAndClose()">Speichern</button>
            </div>
            
            <div class="carmen-note">
                for Carmen with ‚ù§Ô∏è
            </div>
        </div>
    </div>

    <script>
        const originalQuestions = {
            1: [
                "Unabh√§ngigkeit ist mir sehr wichtig.",
                "Ich mache meine Sache lieber allein, bevor ich jemanden um Rat frage.",
                "Es f√§llt mir leicht, Zusammenh√§nge zu durchschauen.",
                "Ich m√∂chte nicht einer unter vielen sein.",
                "Ich m√∂chte es im Leben weit bringen.",
                "Ich lasse mich h√§ufiger zu spitzen Bemerkungen hinrei√üen.",
                "Es liegt mir, Verantwortung zu √ºbernehmen.",
                "Ich bin eher ein distanzierter Mensch.",
                "Ich kann gut mit mir allein sein.",
                "Ich ordne mich nicht gerne unter.",
                "Argumente sind mir wichtiger als Emotionen.",
                "Meiner Argumentation ist so leicht keiner gewachsen."
            ],
            2: [
                "Ich neige dazu, mich ausnutzen zu lassen.",
                "Ich sorge sehr f√ºr das Wohl Anderer.",
                "Um des lieben Friedens willen gebe ich nach.",
                "Ich kann es nicht gut ertragen, wenn sich Menschen nicht vertragen.",
                "Ich bin ein friedlicher Mensch.",
                "Bescheidenheit ist eine wichtige Eigenschaft.",
                "Ich habe immer ein offenes Ohr f√ºr die Sorgen anderer Menschen.",
                "Ich gehe ungern Konflikte ein.",
                "Ich habe es nicht immer leicht.",
                "Ich wage nicht, meine Meinung zu sagen, wenn sie von der anderer abweicht.",
                "Ich m√∂chte auch mal verw√∂hnt werden.",
                "Dauernd will einer was von mir."
            ],
            3: [
                "Es ist mir wichtig, meiner Sache ganz sicher zu sein.",
                "Ich w√§ge lange ab, bevor ich mich entscheide.",
                "Ich lasse lieber alles beim Alten.",
                "Es ist mir wichtig, die √úbersicht zu haben.",
                "Ich w√ºrde nie unvorbereitet in eine unbekannte Situation hineinspringen.",
                "Gesetze sind dazu da, eingehalten zu werden; ich halte mich auch daran.",
                "Ich bin belastungsf√§hig.",
                "Ich halte mich f√ºr einen eher konservativen Menschen.",
                "Vertrauen ist gut, Kontrolle ist besser.",
                "Ich bin ein zuverl√§ssiger Mensch.",
                "Wie es drinnen aussieht, geht niemanden etwas an.",
                "Ich gehe nicht gerne ein Risiko ein."
            ],
            4: [
                "Von mir gehen kreative Impulse aus.",
                "Ich neige zu Unp√ºnktlichkeit.",
                "Regeln empfinde ich als Begrenzung meiner Freiheit.",
                "Ich kann m√ºhelos eine ganze Gesellschaft unterhalten.",
                "Ich habe Angst, abgelehnt zu werden.",
                "Ich kann schlecht warten.",
                "Ich bin ausgesprochen kontaktfreudig.",
                "Ich mag es, bewundert zu werden.",
                "Ich kann mich schnell f√ºr etwas begeistern.",
                "Der Reiz des Neuen ist schnell vorbei.",
                "Ich bin leider so inkonsequent.",
                "Mich bewegen Dinge schnell."
            ]
        };

        const categoryNames = {
            1: 'Distanz',
            2: 'N√§he', 
            3: 'Dauer',
            4: 'Wechsel'
        };

        const typeDescriptions = {
            'Distanz': {
                'general': 'verstandsbetonte Grundorientierung, Wunsch nach Abgrenzung, unabh√§ngiges Handeln',
                'sonnenseiten': 'M√∂gliche Sonnenseiten: eigenst√§ndig, Verantwortung √ºbernehmend, konfliktf√§hig, unabh√§ngig, entschlossen, kann nein sagen, analytisch, entscheidungsstark',
                'schattenseiten': 'M√∂gliche Schattenseiten: Tendenz zu Arroganz und Misstrauen, kontaktscheu, bindungs√§ngstlich, rivalisierend, verschlossen, k√ºhl',
                'konfliktverhalten': 'sachorientiert, prinzipienverteidigend, ironisch, zynisch',
                'umgangKrisen': 'Selbstkl√§rung, erst nach eigener Klarheit, Gespr√§ch mit anderen',
                'angstVor': 'viel Gef√ºhl, enger Bindung, Aufgaben mit wenig Verantwortung, Unterlegenheit',
                'unterst√ºtzung': 'Bewusst N√§he zulassen: Gef√ºhle teilen und pers√∂nliche Begegnungen zulassen. Nicht zu sehr zur√ºckziehen: Menschen gezielt einbeziehen, statt Probleme im Alleingang zu w√§lzen. Rationalit√§t und Emotion verbinden: Entscheidungen nicht nur mit dem Kopf, sondern auch mit dem Bauchgef√ºhl pr√ºfen. Kommunikation pflegen: Kontakte aktiv halten. St√§rken bewusst einbringen: Als analytischer Beobachter Gegenpol zu impulsiveren Charakteren sein.',
                'role': 'analytischer Beobachter, Gegenpol zu impulsiveren Charakteren'
            },
            'N√§he': {
                'general': 'gef√ºhlsbetonte Grundorientierung, Wunsch nach intensivem Kontakt, Mitgef√ºhl und Best√§tigung, Sehnsucht nach Liebe, Geborgenheit und Harmonie, das Zwischenmenschliche steht im Vordergrund',
                'sonnenseiten': 'M√∂gliche Sonnenseiten: liebevoll, kontaktfreudig, anpassungsf√§hig, kooperativ, einf√ºhlsam, verst√§ndnisvoll, gibt Fehler zu, tolerant',
                'schattenseiten': 'M√∂gliche Schattenseiten: Tendenz zur Selbstaufgabe, Tendenz zur Abh√§ngigkeit, konfliktscheu, kann schwer nein sagen',
                'konfliktverhalten': 'konfliktvermeidend, kompromissbereit, sucht Schuld zuerst bei sich selbst, beklagt sich bei Dritten',
                'umgangKrisen': 'will sich mit jemandem besprechen, sich ausweinen, klagen, kleiner Anlass gro√üe Folgen',
                'angstVor': 'alleine sein, Entzug von Zuwendung, zuviel Autonomie, Konflikten',
                'unterst√ºtzung': 'Eigene Bed√ºrfnisse ernst nehmen: Selbstf√ºrsorge aktiv einplanen. Nein-Sagen lernen: Grenzen setzen ohne Rechtfertigungen. Konflikte konstruktiv √ºben: eigene Empfindungen und Bed√ºrfnisse zeitnah aussprechen. Selbstwert st√§rken: eigene St√§rken bewusst wahrnehmen und feiern. St√§rken bewusst einbringen: Gemeinschaft f√∂rdern, Br√ºcken bauen, Harmonie herstellen.',
                'role': 'Gemeinschaft f√∂rdern, Br√ºcken bauen, Harmonie herstellen'
            },
            'Dauer': {
                'general': 'ordnungsbetonte Grundorientierung, Wunsch nach Verl√§sslichkeit und Sicherheit, legt Wert auf Prinzipien, braucht klare Regeln, Sparsamkeit, Bed√ºrfnis nach Kontrolle',
                'sonnenseiten': 'M√∂gliche Sonnenseiten: zuverl√§ssig, treu, ordentlich, organisiert, systematisch, gr√ºndlich, verl√§sslich, √ºbernimmt Verantwortung, hohes Pflichtgef√ºhl',
                'schattenseiten': 'M√∂gliche Schattenseiten: kontrollierend, unflexibel, vorsichtig, pedantisch, dogmatisch, starr, zwanghaft',
                'konfliktverhalten': 'beharrt auf Prinzipien und Regeln, unnachgiebig, vehement, delegiert an einen ‚ÄûRichter"',
                'umgangKrisen': 'Selbstkl√§rung vor Gespr√§ch mit anderen, bewahrt Haltung und Orientierung, h√§lt sich an Routinen, Strukturen und das Gewohnte',
                'angstVor': 'Ver√§nderung, Unvorhergesehenem, Spontanit√§t, Chaos',
                'unterst√ºtzung': 'Ver√§nderungen als Erg√§nzung sehen: Nicht alles Alte muss gehen, wenn Neues kommt. Kleine Schritte statt gro√üer Spr√ºnge: Ver√§nderungen, in einem Tempo angehen, das Sicherheit gibt. Offen √ºber Unsicherheiten sprechen: Rechtzeitige Kommunikation, bei Unklarheiten oder zu hohem Tempo. Bewusst Flexibilit√§t √ºben: Regelm√§√üig kleine neue Dinge ausprobieren. Verl√§sslichkeit als St√§rke einbringen: in Krisen der ruhende Pol sein.',
                'role': 'in Krisen der ruhende Pol sein'
            },
            'Wechsel': {
                'general': 'risikobetonte Grundorientierung, Wunsch nach Ver√§nderung/Abwechslung, legt Wert auf Entwicklung, Spontanit√§t, inspirativ',
                'sonnenseiten': 'M√∂gliche Sonnenseiten: kreativ, spontan, charmant, unterhaltsam, fantasievoll, dynamisch, lebendig',
                'schattenseiten': 'M√∂gliche Schattenseiten: Tendenz zu Unzuverl√§ssigkeit, launisch, chaotisch, oberfl√§chlich, fehleranf√§llig, sprunghaft, unp√ºnktlich',
                'konfliktverhalten': 'wenig kritikf√§hig, Fehler in den Umst√§nden suchen, impulsiv, laut, Konflikte als Dynamik statt Bedrohung, widerspr√ºchlich in der Argumentation',
                'umgangKrisen': 'blinder Aktionismus, unruhig, sprunghaft, Dramen und Szenen werden inszeniert',
                'angstVor': 'Regelm√§√üigkeiten, Grenzen und Normen, Verpflichtungen, Routinearbeiten, Monotonie, Langeweile',
                'unterst√ºtzung': 'Nicht jede Idee sofort umsetzen: erst pr√ºfen, was ist wirklich machbar. Durchhalteverm√∂gen trainieren: kleine Zwischenziele setzen und sich bewusst auf Dinge einlassen, die l√§nger dauern. Verl√§sslichkeit f√ºr andere: Absprachen klar kommunizieren und einhalten. Bewusst Pausen einbauen: nicht immer sofort auf alles reagieren, sondern auch mal innehalten. St√§rken bewusst einsetzen: In Ver√§nderungssituation Motor und Mutmacher sein.',
                'role': 'Motor und Mutmacher in Ver√§nderungssituationen'
            }
        };

        // Create mixed questions array with category tracking
        let mixedQuestions = [];
        let questionMapping = {};

        // Default point values
        let pointValues = {
            3: 1.00,    // stimmt genau
            2: 0.67,    // stimmt eher
            1: 0.33,    // stimmt wenig
            0: 0.00     // stimmt nicht
        };

        let answers = {};

        // LocalStorage Funktionen
        function saveProgress() {
            const progress = {
                answers: answers,
                questionMapping: questionMapping,
                mixedQuestions: mixedQuestions,
                pointValues: pointValues,
                timestamp: Date.now()
            };
            localStorage.setItem('riemannTestProgress', JSON.stringify(progress));
        }

        function loadProgress() {
            const saved = localStorage.getItem('riemannTestProgress');
            if (saved) {
                try {
                    const progress = JSON.parse(saved);
                    // Pr√ºfe ob der gespeicherte Fortschritt nicht √§lter als 24 Stunden ist
                    if (Date.now() - progress.timestamp < 24 * 60 * 60 * 1000) {
                        answers = progress.answers || {};
                        questionMapping = progress.questionMapping || {};
                        mixedQuestions = progress.mixedQuestions || [];
                        pointValues = progress.pointValues || { 3: 1.00, 2: 0.67, 1: 0.33, 0: 0.00 };
                        return true;
                    } else {
                        // L√∂sche abgelaufenen Fortschritt
                        localStorage.removeItem('riemannTestProgress');
                    }
                } catch (e) {
                    console.error('Fehler beim Laden des Fortschritts:', e);
                    localStorage.removeItem('riemannTestProgress');
                }
            }
            return false;
        }

        function clearProgress() {
            localStorage.removeItem('riemannTestProgress');
        }

        function initializeMixedQuestions() {
            mixedQuestions = [];
            questionMapping = {};
            
            // Create array of all questions with category info
            for (let category = 1; category <= 4; category++) {
                originalQuestions[category].forEach((question, index) => {
                    mixedQuestions.push({
                        text: question,
                        category: category,
                        originalIndex: index
                    });
                });
            }
            
            // Shuffle the questions
            for (let i = mixedQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [mixedQuestions[i], mixedQuestions[j]] = [mixedQuestions[j], mixedQuestions[i]];
            }
            
            // Create mapping for later evaluation
            mixedQuestions.forEach((question, index) => {
                questionMapping[index] = question.category;
            });
        }

        function loadQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            // Debug: Pr√ºfe ob mixedQuestions existiert und gef√ºllt ist
            if (!mixedQuestions || mixedQuestions.length === 0) {
                console.log('mixedQuestions ist leer, initialisiere neu...');
                initializeMixedQuestions();
            }
            
            console.log('Lade Fragen, Anzahl:', mixedQuestions.length);
            
            mixedQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                // Pr√ºfe ob eine gespeicherte Antwort existiert
                const savedAnswer = answers[index];
                const checkedValue = savedAnswer ? savedAnswer.value : '';
                
                questionDiv.innerHTML = `
                    <div class="question-number">Frage ${index + 1} von 48</div>
                    <div class="question-text">${question.text}</div>
                    <div class="options">
                        <div class="option">
                            <input type="radio" id="q${index}_3" name="q${index}" value="3" ${checkedValue === '3' ? 'checked' : ''}>
                            <label for="q${index}_3">stimmt genau</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_2" name="q${index}" value="2" ${checkedValue === '2' ? 'checked' : ''}>
                            <label for="q${index}_2">stimmt eher</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_1" name="q${index}" value="1" ${checkedValue === '1' ? 'checked' : ''}>
                            <label for="q${index}_1">stimmt wenig</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_0" name="q${index}" value="0" ${checkedValue === '0' ? 'checked' : ''}>
                            <label for="q${index}_0">stimmt nicht</label>
                        </div>
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });

            // Add event listeners for progress tracking
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.addEventListener('change', updateProgress);
            });

            // Add scroll event listener for seamless scrolling
            setupSeamlessScrolling();
        }

        function updateProgress() {
            const totalQuestions = mixedQuestions.length;
            let answeredQuestions = 0;
            
            // Sammle alle Antworten
            for (let i = 0; i < totalQuestions; i++) {
                const answer = document.querySelector(`input[name="q${i}"]:checked`);
                if (answer) {
                    answeredQuestions++;
                    // Speichere Antwort
                    answers[i] = {
                        value: answer.value,
                        question: mixedQuestions[i].text,
                        category: questionMapping[i]
                    };
                } else {
                    // L√∂sche gespeicherte Antwort wenn keine ausgew√§hlt
                    delete answers[i];
                }
            }
            
            // Speichere Fortschritt
            saveProgress();
            
            const progress = (answeredQuestions / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressInfo').textContent = 
                `Frage ${answeredQuestions} von ${totalQuestions} beantwortet`;
            
            // Enable/disable complete button
            const completeBtn = document.getElementById('completeBtn');
            const forceCompleteBtn = document.getElementById('forceCompleteBtn');
            
            if (answeredQuestions === totalQuestions) {
                completeBtn.disabled = false;
                completeBtn.textContent = 'Test abschlie√üen ‚úì';
                forceCompleteBtn.disabled = true;
                forceCompleteBtn.style.display = 'none';
            } else {
                completeBtn.disabled = true;
                completeBtn.textContent = `Noch ${totalQuestions - answeredQuestions} Fragen offen`;
                
                // Show/hide force complete button based on answered questions
                if (answeredQuestions > 0) {
                    forceCompleteBtn.disabled = false;
                    forceCompleteBtn.style.display = 'block';
                    forceCompleteBtn.textContent = `Test trotzdem abschlie√üen (${answeredQuestions}/${totalQuestions})`;
                } else {
                    forceCompleteBtn.disabled = true;
                    forceCompleteBtn.style.display = 'none';
                }
            }
        }

        function completeTest() {
            // Check if all questions are answered
            const totalQuestions = mixedQuestions.length;
            let answeredQuestions = 0;
            
            for (let i = 0; i < totalQuestions; i++) {
                const answer = document.querySelector(`input[name="q${i}"]:checked`);
                if (answer) answeredQuestions++;
            }
            
            if (answeredQuestions < totalQuestions) {
                alert(`Bitte beantworte alle Fragen. ${totalQuestions - answeredQuestions} Fragen sind noch offen.`);
                return;
            }
            
            calculateResults();
        }

        function forceCompleteTest() {
            // Check if at least some questions are answered
            const totalQuestions = mixedQuestions.length;
            let answeredQuestions = 0;
            
            for (let i = 0; i < totalQuestions; i++) {
                const answer = document.querySelector(`input[name="q${i}"]:checked`);
                if (answer) answeredQuestions++;
            }
            
            if (answeredQuestions === 0) {
                alert('Bitte beantworte mindestens eine Frage, bevor du den Test abschlie√üt.');
                return;
            }
            
            if (answeredQuestions < totalQuestions) {
                const confirmMessage = `Du hast nur ${answeredQuestions} von ${totalQuestions} Fragen beantwortet. M√∂chtest du den Test trotzdem abschlie√üen?`;
                if (!confirm(confirmMessage)) {
                    return;
                }
            }
            
            calculateResults();
        }

        function calculateResults() {
            const scores = { 1: 0, 2: 0, 3: 0, 4: 0 };
            answers = {};
            
            for (let i = 0; i < mixedQuestions.length; i++) {
                const answer = document.querySelector(`input[name="q${i}"]:checked`);
                if (answer) {
                    const category = questionMapping[i];
                    const answerValue = parseInt(answer.value);
                    const points = pointValues[answerValue];
                    
                    scores[category] += points;
                    
                    // Store answer for detail view
                    if (!answers[category]) answers[category] = [];
                    answers[category].push({
                        question: mixedQuestions[i].text,
                        answer: getAnswerText(answerValue),
                        points: points
                    });
                }
            }
            
            showResults(scores);
        }

        function getAnswerText(value) {
            const answerTexts = {
                3: 'stimmt genau',
                2: 'stimmt eher', 
                1: 'stimmt wenig',
                0: 'stimmt nicht'
            };
            return answerTexts[value];
        }

        function showResults(scores) {
            document.getElementById('questionsContainer').style.display = 'none';
            document.getElementById('navigation').style.display = 'none';
            document.getElementById('results').classList.add('active');
            
            // Check if custom weights are used
            const isCustom = !isStandardWeights();
            document.getElementById('customWeightsNotice').style.display = isCustom ? 'block' : 'none';
            
            // Update score displays
            document.getElementById('scoreDistanz').textContent = scores[1].toFixed(1);
            document.getElementById('scoreNaehe').textContent = scores[2].toFixed(1);
            document.getElementById('scoreDauer').textContent = scores[3].toFixed(1);
            document.getElementById('scoreWechsel').textContent = scores[4].toFixed(1);
            
            // Sort types by score (highest first)
            const typeScores = [
                { type: 'Distanz', score: scores[1] },
                { type: 'N√§he', score: scores[2] },
                { type: 'Dauer', score: scores[3] },
                { type: 'Wechsel', score: scores[4] }
            ].sort((a, b) => b.score - a.score);
            
            // Create personality types display
            const personalityTypesContainer = document.getElementById('personalityTypes');
            personalityTypesContainer.innerHTML = '';
            
            typeScores.forEach((typeData, index) => {
                const typeInfo = typeDescriptions[typeData.type];
                const isFirst = index === 0; // First one is dominant
                
                const typeHTML = `
                    <div class="personality-type">
                        <div class="personality-type-header ${isFirst ? 'active' : ''}" onclick="togglePersonalityType(this)">
                            <h3>${typeData.type}${isFirst ? ' (Dominant)' : ''}</h3>
                            <div class="personality-type-score">${typeData.score.toFixed(1)} Punkte</div>
                            <span class="toggle-icon">${isFirst ? '‚ñº' : '‚ñ∂'}</span>
                        </div>
                        <div class="personality-type-content ${isFirst ? 'active' : ''}">
                            <h4>Beschreibung:</h4>
                            <p>${typeInfo.general}</p>
                            
                            <h4>Sonnenseiten:</h4>
                            <p>${typeInfo.sonnenseiten}</p>
                            
                            <h4>Schattenseiten:</h4>
                            <p>${typeInfo.schattenseiten}</p>
                            
                            <h4>Konfliktverhalten:</h4>
                            <p>${typeInfo.konfliktverhalten}</p>
                            
                            <h4>Umgang mit Krisen:</h4>
                            <p>${typeInfo.umgangKrisen}</p>
                            
                            <h4>Angst vor:</h4>
                            <p>${typeInfo.angstVor}</p>
                            
                            <h4>Was kann mich unterst√ºtzen:</h4>
                            <p>${typeInfo.unterst√ºtzung}</p>
                        </div>
                    </div>
                `;
                
                personalityTypesContainer.innerHTML += typeHTML;
            });
            
            // Update visualization
            updateVisualization(scores);
            
            // Create question details
            createQuestionDetails();
            
            // Update progress to 100%
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('progressInfo').textContent = 'Test abgeschlossen!';
        }

        function createQuestionDetails() {
            const detailsContent = document.getElementById('detailsContent');
            detailsContent.innerHTML = '';
            
            for (let category = 1; category <= 4; category++) {
                const categorySection = document.createElement('div');
                categorySection.className = 'category-section';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = `${categoryNames[category]} (${answers[category] ? answers[category].reduce((sum, a) => sum + a.points, 0).toFixed(1) : '0.0'} Punkte)`;
                categorySection.appendChild(categoryTitle);
                
                if (answers[category]) {
                    answers[category].forEach(answer => {
                        const answerItem = document.createElement('div');
                        answerItem.className = 'answer-item';
                        
                        answerItem.innerHTML = `
                            <div class="answer-question">${answer.question}</div>
                            <div class="answer-value">${answer.answer}</div>
                        `;
                        
                        categorySection.appendChild(answerItem);
                    });
                }
                
                detailsContent.appendChild(categorySection);
            }
        }

        function toggleDetails() {
            const content = document.getElementById('detailsContent');
            const icon = document.getElementById('toggleIcon');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('active');
                icon.textContent = '‚ñ≤';
            }
        }

        function restartTest() {
            // Clear saved progress
            clearProgress();
            
            // Reset all radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.checked = false;
            });
            
            // Reset answers
            answers = {};
            
            // Remix questions
            initializeMixedQuestions();
            loadQuestions();
            
            // Show questions container
            document.getElementById('questionsContainer').style.display = 'block';
            document.getElementById('navigation').style.display = 'flex';
            document.getElementById('results').classList.remove('active');
            
            // Reset progress
            updateProgress();
            
            // Reset details toggle
            document.getElementById('detailsContent').classList.remove('active');
            document.getElementById('toggleIcon').textContent = '‚ñº';
            
            // Scroll to first question
            document.getElementById('questionsContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // Visualization Functions (unchanged from previous version)
        function updateVisualization(scores) {
            const maxPossible = pointValues[3] * 12;
            const centerX = 250;
            const centerY = 250;
            const maxRadius = 150;
            
            const positions = {
                dauer: {
                    x: centerX,
                    y: centerY - (scores[3] / maxPossible) * maxRadius
                },
                distanz: {
                    x: centerX + (scores[1] / maxPossible) * maxRadius,
                    y: centerY
                },
                wechsel: {
                    x: centerX,
                    y: centerY + (scores[4] / maxPossible) * maxRadius
                },
                naehe: {
                    x: centerX - (scores[2] / maxPossible) * maxRadius,
                    y: centerY
                }
            };
            
            document.getElementById('distanzPoint').setAttribute('cx', positions.distanz.x);
            document.getElementById('distanzPoint').setAttribute('cy', positions.distanz.y);
            
            document.getElementById('naehePoint').setAttribute('cx', positions.naehe.x);
            document.getElementById('naehePoint').setAttribute('cy', positions.naehe.y);
            
            document.getElementById('dauerPoint').setAttribute('cx', positions.dauer.x);
            document.getElementById('dauerPoint').setAttribute('cy', positions.dauer.y);
            
            document.getElementById('wechselPoint').setAttribute('cx', positions.wechsel.x);
            document.getElementById('wechselPoint').setAttribute('cy', positions.wechsel.y);
            
            const polygonPoints = [
                `${positions.dauer.x},${positions.dauer.y}`,
                `${positions.distanz.x},${positions.distanz.y}`,
                `${positions.wechsel.x},${positions.wechsel.y}`,
                `${positions.naehe.x},${positions.naehe.y}`
            ].join(' ');
            
            document.getElementById('profilePolygon').setAttribute('points', polygonPoints);
            
            updateGridAndScale(maxPossible, maxRadius, centerX, centerY);
        }
        
        function updateGridAndScale(maxPossible, maxRadius, centerX, centerY) {
            const gridContainer = document.getElementById('gridLines');
            const scaleContainer = document.getElementById('scaleMarkers');
            
            gridContainer.innerHTML = '';
            scaleContainer.innerHTML = '';
            
            const steps = 4;
            for (let i = 1; i <= steps; i++) {
                const radius = (maxRadius / steps) * i;
                const value = (maxPossible / steps) * i;
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', centerX);
                circle.setAttribute('cy', centerY);
                circle.setAttribute('r', radius);
                circle.setAttribute('class', 'grid-line');
                circle.setAttribute('fill', 'none');
                gridContainer.appendChild(circle);
                
                // Skalenmarkierungen f√ºr alle vier Achsen
                // Dauer (oben)
                const scaleTextDauer = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                scaleTextDauer.setAttribute('x', centerX + 8);
                scaleTextDauer.setAttribute('y', centerY - radius + 3);
                scaleTextDauer.setAttribute('class', 'scale-text');
                scaleTextDauer.textContent = Math.round(value);
                scaleContainer.appendChild(scaleTextDauer);
                
                // Wechsel (unten)
                const scaleTextWechsel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                scaleTextWechsel.setAttribute('x', centerX + 8);
                scaleTextWechsel.setAttribute('y', centerY + radius + 3);
                scaleTextWechsel.setAttribute('class', 'scale-text');
                scaleTextWechsel.textContent = Math.round(value);
                scaleContainer.appendChild(scaleTextWechsel);
                
                // Distanz (rechts)
                const scaleTextDistanz = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                scaleTextDistanz.setAttribute('x', centerX + radius + 8);
                scaleTextDistanz.setAttribute('y', centerY + 3);
                scaleTextDistanz.setAttribute('class', 'scale-text');
                scaleTextDistanz.textContent = Math.round(value);
                scaleContainer.appendChild(scaleTextDistanz);
                
                // N√§he (links)
                const scaleTextNaehe = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                scaleTextNaehe.setAttribute('x', centerX - radius - 8);
                scaleTextNaehe.setAttribute('y', centerY + 3);
                scaleTextNaehe.setAttribute('class', 'scale-text');
                scaleTextNaehe.textContent = Math.round(value);
                scaleContainer.appendChild(scaleTextNaehe);
            }
            
            // Zentrumspunkt
            const centerPoint = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerPoint.setAttribute('cx', centerX);
            centerPoint.setAttribute('cy', centerY);
            centerPoint.setAttribute('r', '3');
            centerPoint.setAttribute('fill', '#666');
            scaleContainer.appendChild(centerPoint);
            

        }

        // Settings Functions (unchanged from previous version)
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            updatePointInputs();
            updateMaxPoints();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function updatePointInputs() {
            document.getElementById('points3').value = pointValues[3].toFixed(2);
            document.getElementById('points2').value = pointValues[2].toFixed(2);
            document.getElementById('points1').value = pointValues[1].toFixed(2);
            document.getElementById('points0').value = pointValues[0].toFixed(2);
        }

        function updateMaxPoints() {
            const maxPoints = pointValues[3] * 12 * 4;
            document.getElementById('maxPointsDisplay').textContent = 
                `Maximale Gesamtpunktzahl: ${maxPoints.toFixed(1)}`;
        }

        function applyPreset(presetName) {
            switch(presetName) {
                case 'standard':
                    pointValues = { 3: 1.00, 2: 0.67, 1: 0.33, 0: 0.00 };
                    break;
                case 'linear':
                    pointValues = { 3: 3.00, 2: 2.00, 1: 1.00, 0: 0.00 };
                    break;
                case 'weighted':
                    pointValues = { 3: 2.00, 2: 1.00, 1: 0.50, 0: 0.00 };
                    break;
                case 'binary':
                    pointValues = { 3: 1.00, 2: 1.00, 1: 0.00, 0: 0.00 };
                    break;
            }
            updatePointInputs();
            updateMaxPoints();
            // Speichere neue Punktwerte sofort
            saveProgress();
        }

        function resetToDefaults() {
            applyPreset('standard');
        }

        function saveSettingsAndClose() {
            // Werte aus Inputs lesen und in pointValues √ºbernehmen
            const p3 = parseFloat(document.getElementById('points3').value);
            const p2 = parseFloat(document.getElementById('points2').value);
            const p1 = parseFloat(document.getElementById('points1').value);
            const p0 = parseFloat(document.getElementById('points0').value);
            
            if (!isNaN(p3)) pointValues[3] = p3;
            if (!isNaN(p2)) pointValues[2] = p2;
            if (!isNaN(p1)) pointValues[1] = p1;
            if (!isNaN(p0)) pointValues[0] = p0;
            
            updatePointInputs();
            updateMaxPoints();
            saveProgress();
            closeSettings();
        }





        function setupSeamlessScrolling() {
            const questionsContainer = document.getElementById('questionsContainer');
            let isScrolling = false;
            let scrollTimeout;

            questionsContainer.addEventListener('scroll', function(e) {
                if (isScrolling) return;
                
                const container = e.target;
                const scrollTop = container.scrollTop;
                const scrollHeight = container.scrollHeight;
                const clientHeight = container.clientHeight;
                
                // Pr√ºfe ob am oberen oder unteren Ende
                const isAtTop = scrollTop <= 0;
                const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5; // 5px Toleranz
                
                if (isAtTop || isAtBottom) {
                    isScrolling = true;
                    
                    // Verz√∂gerung um zu verhindern, dass zu oft gescrollt wird
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        isScrolling = false;
                    }, 100);
                    
                    // Scroll die gesamte Seite
                    const scrollDirection = isAtTop ? -1 : 1;
                    const scrollAmount = 100; // 100px pro Scroll
                    
                    window.scrollBy({
                        top: scrollDirection * scrollAmount,
                        behavior: 'smooth'
                    });
                }
            });

            // Touch-Scroll f√ºr mobile Ger√§te
            let touchStartY = 0;
            let touchEndY = 0;

            questionsContainer.addEventListener('touchstart', function(e) {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            questionsContainer.addEventListener('touchend', function(e) {
                touchEndY = e.changedTouches[0].clientY;
                const touchDiff = touchStartY - touchEndY;
                
                // Pr√ºfe ob Touch-Scroll am Ende der Fragenliste
                const container = questionsContainer;
                const scrollTop = container.scrollTop;
                const scrollHeight = container.scrollHeight;
                const clientHeight = container.clientHeight;
                
                const isAtTop = scrollTop <= 0 && touchDiff < 0; // Nach oben scrollen am oberen Ende
                const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5 && touchDiff > 0; // Nach unten scrollen am unteren Ende
                
                if (isAtTop || isAtBottom) {
                    // Scroll die gesamte Seite
                    const scrollDirection = isAtTop ? -1 : 1;
                    const scrollAmount = 150; // Etwas mehr f√ºr Touch
                    
                    window.scrollBy({
                        top: scrollDirection * scrollAmount,
                        behavior: 'smooth'
                    });
                }
            }, { passive: true });
        }

        async function downloadPDF() {
            try {
                // Zeige Ladeindikator
                const downloadBtn = document.querySelector('.download-btn');
                const originalText = downloadBtn.textContent;
                downloadBtn.textContent = 'üíæ PDF wird erstellt...';
                downloadBtn.disabled = true;

                // Hole die aktuellen Scores
                const scores = {};
                scores[1] = parseFloat(document.getElementById('scoreDistanz').textContent);
                scores[2] = parseFloat(document.getElementById('scoreNaehe').textContent);
                scores[3] = parseFloat(document.getElementById('scoreDauer').textContent);
                scores[4] = parseFloat(document.getElementById('scoreWechsel').textContent);

                // Bestimme dominanten Typ
                const typeScores = [
                    { type: 'Distanz', score: scores[1] },
                    { type: 'N√§he', score: scores[2] },
                    { type: 'Dauer', score: scores[3] },
                    { type: 'Wechsel', score: scores[4] }
                ].sort((a, b) => b.score - a.score);

                // Erstelle das Diagramm als PNG (Safari-optimiert)
                const chartContainer = document.querySelector('.chart-container');
                const chartCanvas = await html2canvas(chartContainer, {
                    scale: 2.0,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false,
                    allowTaint: true,
                    foreignObjectRendering: false
                });

                // Erstelle PDF mit jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // PDF Einstellungen
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 25;
                const contentWidth = pageWidth - (2 * margin);

                // SEITE 1: Titel und √úbersicht (noch kleinerer oberer Rand)
                let yPosition = 22;

                // Haupttitel
                // Professionellere Farbpalette
                pdf.setFontSize(26);
                pdf.setTextColor(37, 99, 235); // #2563eb
                pdf.setFont(undefined, 'bold');
                pdf.text('Riemann-Thomann', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 6;

                // Entfernt: Zweittitel "Pers√∂nlichkeitstest"

                // Untertitel
                pdf.setFontSize(12);
                pdf.setTextColor(71, 85, 105); // slate-600
                pdf.setFont(undefined, 'normal');
                pdf.text('Ihr pers√∂nliches Pers√∂nlichkeitsprofil', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 12;

                // Diagramm (etwas kleiner, damit Scores h√∂her r√ºcken)
                const chartWidth = 148;
                const chartHeight = 148;
                const chartX = (pageWidth - chartWidth) / 2;
                
                pdf.addImage(chartCanvas.toDataURL('image/png'), 'PNG', chartX, yPosition, chartWidth, chartHeight);
                yPosition += chartHeight + 10;

                // Scores Grid (h√∂her positioniert)
                const scoreBoxWidth = 42;
                const scoreBoxHeight = 28;
                const scoreSpacing = 6;
                const totalScoreWidth = (scoreBoxWidth * 4) + (scoreSpacing * 3);
                const scoreStartX = (pageWidth - totalScoreWidth) / 2;

                const scoreLabels = ['Distanz', 'N√§he', 'Dauer', 'Wechsel'];
                const scoreValues = [scores[1], scores[2], scores[3], scores[4]];

                for (let i = 0; i < 4; i++) {
                    const x = scoreStartX + (i * (scoreBoxWidth + scoreSpacing));
                    
                    // Score Box
                    pdf.setFillColor(37, 99, 235); // primary blue
                    pdf.rect(x, yPosition, scoreBoxWidth, scoreBoxHeight, 'F');
                    
                    // Score Label
                    pdf.setFontSize(10);
                    pdf.setTextColor(255, 255, 255);
                    pdf.text(scoreLabels[i], x + scoreBoxWidth/2, yPosition + 7, { align: 'center' });
                    
                    // Score Value
                    pdf.setFontSize(16);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(scoreValues[i].toFixed(1), x + scoreBoxWidth/2, yPosition + 20, { align: 'center' });
                }
                yPosition += scoreBoxHeight + 15;

                // Dominanter Typ (kompakter)
                const dominantType = typeScores[0];
                pdf.setFillColor(232, 245, 232);
                pdf.rect(margin, yPosition, contentWidth, 18, 'F');
                
                pdf.setFontSize(13);
                pdf.setTextColor(34, 197, 94); // green-500
                pdf.setFont(undefined, 'bold');
                pdf.text(`Ihr dominanter Typ: ${dominantType.type}`, margin + 8, yPosition + 11);
                
                pdf.setFontSize(11);
                pdf.text(`${dominantType.score.toFixed(1)} Punkte`, pageWidth - margin - 8, yPosition + 11, { align: 'right' });

                // Footer Seite 1
                pdf.setFontSize(10);
                pdf.setTextColor(102, 102, 102);
                pdf.text(`Erstellt am: ${new Date().toLocaleDateString('de-DE')}`, margin, pageHeight - 15);
                pdf.text('Riemann-Thomann Pers√∂nlichkeitstest - Carmen Michaelis', pageWidth - margin, pageHeight - 15, { align: 'right' });

                // SEITE 2: Inhaltsverzeichnis
                pdf.addPage();
                yPosition = 50;

                pdf.setFontSize(20);
                pdf.setTextColor(37, 99, 235);
                pdf.setFont(undefined, 'bold');
                pdf.text('Inhaltsverzeichnis', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 30;

                pdf.setFontSize(14);
                pdf.setTextColor(44, 62, 80);
                pdf.setFont(undefined, 'bold');
                pdf.text('Ihre Pers√∂nlichkeitstypen:', margin, yPosition);
                yPosition += 15;

                for (let i = 0; i < typeScores.length; i++) {
                    const typeData = typeScores[i];
                    pdf.setFontSize(12);
                    pdf.setTextColor(37, 99, 235);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`${i + 1}. ${typeData.type}`, margin, yPosition);
                    
                    pdf.setFontSize(10);
                    pdf.setTextColor(102, 102, 102);
                    pdf.setFont(undefined, 'normal');
                    pdf.text(`${typeData.score.toFixed(1)} Punkte`, pageWidth - margin - 5, yPosition, { align: 'right' });
                    yPosition += 8;
                }

                // Footer Seite 2
                pdf.setFontSize(10);
                pdf.setTextColor(102, 102, 102);
                pdf.text(`Seite 2 von ${4 + typeScores.length}`, pageWidth - margin, pageHeight - 15, { align: 'right' });

                // SEITEN 3-6: Jeder Pers√∂nlichkeitstyp auf einer eigenen Seite
                for (let i = 0; i < typeScores.length; i++) {
                    const typeData = typeScores[i];
                    const typeInfo = typeDescriptions[typeData.type];
                    
                    pdf.addPage();
                    yPosition = 40;

                    // Typ Header
                    pdf.setFillColor(37, 99, 235);
                    pdf.rect(margin, yPosition, contentWidth, 25, 'F');
                    
                    pdf.setFontSize(18);
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFont(undefined, 'bold');
                    const typeTitle = `${typeData.type}${i === 0 ? ' (Dominant)' : ''}`;
                    pdf.text(typeTitle, margin + 10, yPosition + 16);
                    
                    pdf.setFontSize(14);
                    pdf.text(`${typeData.score.toFixed(1)} Punkte`, pageWidth - margin - 10, yPosition + 16, { align: 'right' });
                    yPosition += 35;

                    // Beschreibung
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Beschreibung:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFont(undefined, 'normal');
                    const generalLines = pdf.splitTextToSize(typeInfo.general, contentWidth);
                    pdf.text(generalLines, margin, yPosition);
                    yPosition += generalLines.length * 5 + 12;

                    // Sonnenseiten
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Sonnenseiten:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFont(undefined, 'normal');
                    const sonnenseitenLines = pdf.splitTextToSize(typeInfo.sonnenseiten, contentWidth);
                    pdf.text(sonnenseitenLines, margin, yPosition);
                    yPosition += sonnenseitenLines.length * 5 + 12;

                    // Schattenseiten
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Schattenseiten:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFont(undefined, 'normal');
                    const schattenseitenLines = pdf.splitTextToSize(typeInfo.schattenseiten, contentWidth);
                    pdf.text(schattenseitenLines, margin, yPosition);
                    yPosition += schattenseitenLines.length * 5 + 12;

                    // Konfliktverhalten
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Konfliktverhalten:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFont(undefined, 'normal');
                    const konfliktLines = pdf.splitTextToSize(typeInfo.konfliktverhalten, contentWidth);
                    pdf.text(konfliktLines, margin, yPosition);
                    yPosition += konfliktLines.length * 5 + 12;

                    // Umgang mit Krisen
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Umgang mit Krisen:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFont(undefined, 'normal');
                    const umgangLines = pdf.splitTextToSize(typeInfo.umgangKrisen, contentWidth);
                    pdf.text(umgangLines, margin, yPosition);
                    yPosition += umgangLines.length * 5 + 12;

                    // Angst vor
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Angst vor:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(51, 51, 51);
                    pdf.setFont(undefined, 'normal');
                    const angstLines = pdf.splitTextToSize(typeInfo.angstVor, contentWidth);
                    pdf.text(angstLines, margin, yPosition);
                    yPosition += angstLines.length * 5 + 12;

                    // Was kann mich unterst√ºtzen
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Was kann mich unterst√ºtzen:', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(11);
                    pdf.setTextColor(52, 152, 219);
                    pdf.setFont(undefined, 'bold');
                    const unterst√ºtzungLines = pdf.splitTextToSize(typeInfo.unterst√ºtzung, contentWidth);
                    pdf.text(unterst√ºtzungLines, margin, yPosition);

                    // Footer
                    pdf.setFontSize(10);
                    pdf.setTextColor(102, 102, 102);
                    pdf.text(`Seite ${3 + i} von ${4 + typeScores.length}`, pageWidth - margin, pageHeight - 15, { align: 'right' });
                }

                // PDF als Blob erstellen f√ºr Sharing
                const pdfBlob = pdf.output('blob');
                const timestamp = new Date().toISOString().slice(0, 10);
                const filename = `Riemann-Thomann-Test_${timestamp}.pdf`;
                
                // PDF-Datei erstellen
                const pdfFile = new File([pdfBlob], filename, { type: 'application/pdf' });
                
                // Safari Mobile: PDF in neuem Tab √∂ffnen und dann Share-Men√º aufrufen
                const isSafariMobile = /Safari/.test(navigator.userAgent) && 
                                     !/Chrome/.test(navigator.userAgent) && 
                                     /iPhone|iPad|iPod/.test(navigator.userAgent);
                
                if (isSafariMobile) {
                    console.log('Safari Mobile erkannt - √∂ffne PDF in neuem Tab');
                    
                    // PDF in neuem Tab √∂ffnen
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                    const newWindow = window.open(pdfUrl, '_blank');
                    
                    // Reset Button
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;
                    
                    // Nach kurzer Verz√∂gerung: Share-Men√º aufrufen
                    setTimeout(async () => {
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [pdfFile] })) {
                            console.log('Share API verf√ºgbar - rufe Share-Men√º auf');
                            
                            const shareData = {
                                title: 'Riemann-Thomann Pers√∂nlichkeitstest',
                                text: `Mein Pers√∂nlichkeitsprofil: ${typeScores[0].type} (${typeScores[0].score.toFixed(1)} Punkte)`,
                                files: [pdfFile]
                            };
                            
                            try {
                                await navigator.share(shareData);
                                console.log('Share-Men√º erfolgreich aufgerufen');
                            } catch (error) {
                                console.log('Share-Men√º Fehler:', error);
                                if (error.name !== 'AbortError') {
                                    alert('PDF wurde ge√∂ffnet. Share-Men√º konnte nicht aufgerufen werden.');
                                }
                            }
                        } else {
                            console.log('Share API nicht verf√ºgbar');
                            alert('PDF wurde in Safari ge√∂ffnet. Sie k√∂nnen das Teilen-Men√º manuell √ºber das Safari-Men√º aufrufen.');
                        }
                    }, 1000); // 1 Sekunde Verz√∂gerung f√ºr Safari
                    
                } else {
                    // Andere Browser: Normaler Download
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Cleanup PDF URL
                    setTimeout(() => {
                        URL.revokeObjectURL(pdfUrl);
                    }, 1000);

                    // Reset Button
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;

                    // Nach Download: Share-Dialog mit PDF anzeigen
                    setTimeout(async () => {
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [pdfFile] })) {
                            console.log('Share API mit PDF-Datei verf√ºgbar, zeige Share-Dialog...');
                            
                            const shareData = {
                                title: 'Riemann-Thomann Pers√∂nlichkeitstest',
                                text: `Mein Pers√∂nlichkeitsprofil: ${typeScores[0].type} (${typeScores[0].score.toFixed(1)} Punkte)`,
                                files: [pdfFile]
                            };
                            
                            try {
                                await navigator.share(shareData);
                                console.log('PDF erfolgreich geteilt');
                            } catch (error) {
                                console.log('Share PDF Fehler:', error);
                                if (error.name !== 'AbortError') {
                                    alert('PDF wurde heruntergeladen. Share-Dialog konnte nicht ge√∂ffnet werden.');
                                }
                            }
                        } else {
                            console.log('Share API mit PDF-Dateien nicht verf√ºgbar');
                            // Zeige Best√§tigung
                            alert(`PDF wurde erfolgreich heruntergeladen: ${filename}\n\nSie k√∂nnen die PDF-Datei jetzt in anderen Apps teilen.`);
                        }
                    }, 500); // Kurze Verz√∂gerung nach Download
                }

            } catch (error) {
                console.error('Fehler beim Erstellen der PDF:', error);
                alert('Fehler beim Erstellen der PDF. Bitte versuchen Sie es erneut.');
                
                // Reset Button
                const downloadBtn = document.querySelector('.download-btn');
                if (downloadBtn) {
                    downloadBtn.textContent = 'üíæ PDF herunterladen';
                    downloadBtn.disabled = false;
                }
            }
        }

        function isStandardWeights() {
            return pointValues[3] === 1.00 && 
                   pointValues[2] === 0.67 && 
                   pointValues[1] === 0.33 && 
                   pointValues[0] === 0.00;
        }

        function togglePersonalityType(headerElement) {
            const contentElement = headerElement.nextElementSibling;
            const iconElement = headerElement.querySelector('.toggle-icon');
            
            if (contentElement.classList.contains('active')) {
                contentElement.classList.remove('active');
                headerElement.classList.remove('active');
                iconElement.textContent = '‚ñ∂';
            } else {
                contentElement.classList.add('active');
                headerElement.classList.add('active');
                iconElement.textContent = '‚ñº';
            }
        }





        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Versuche gespeicherten Fortschritt zu laden
            const hasProgress = loadProgress();
            
            if (!hasProgress) {
                // Kein gespeicherter Fortschritt, starte neu
                initializeMixedQuestions();
            }
            
            // Stelle sicher, dass mixedQuestions initialisiert ist
            if (!mixedQuestions || mixedQuestions.length === 0) {
                initializeMixedQuestions();
            }
            
            loadQuestions();
            updateProgress();
            
            // Add event listeners for real-time updates and persistent save in settings
            ['points3', 'points2', 'points1', 'points0'].forEach(id => {
                const inputEl = document.getElementById(id);
                if (!inputEl) return;
                inputEl.addEventListener('input', function() {
                    const value = parseFloat(inputEl.value);
                    if (!isNaN(value)) {
                        const keyMap = { points3: 3, points2: 2, points1: 1, points0: 0 };
                        const key = keyMap[id];
                        pointValues[key] = value;
                        updateMaxPoints();
                        // Fortschritt inkl. Punktwerte sofort speichern
                        saveProgress();
                    }
                });
            });
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('settingsModal');
            if (e.target === modal) {
                closeSettings();
            }
        });
    </script>
</body>
</html>